my_widget_script={_numEntries:0,_numExits:0,
_duration:NaN,_fileName:"",_startState:"",
_vid:document.getElementById("videoPlayer"),
_timeOffNest:0,_timeOnNest:0,_stampTimes:[],
_stampStates:[],_allDurations:[],_entryStamps:[],
_exitStamps:[],_entryDurs:[],_exitDurs:[],
_percOffNest:0,_percOnNest:0,
init:function(mode,json_data){
this.include("https://www.gstatic.com/charts/loader.js","","",()=>{
$(document).ready(()=>{
this.include("https://code.jquery.com/jquery-3.5.1.min.js","sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=","anonymous",()=>{
$(document).ready(()=>{
this.include("https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js","sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl","anonymous",()=>{
$(document).ready(()=>{
this.include("https://cdn.jsdelivr.net/npm/luxon@1.26.0/build/global/luxon.min.js","sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=","anonymous",()=>{
$(document).ready(()=>{
this.include("https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js","sha512-RdSPYh1WA6BF0RhpisYJVYkOyTzK4HwofJ3Q7ivt/jkpW6Vc8AurL1R+4AUcvn9IwEKAPm/fk7qFZW3OuiUDeg==","anonymous",()=>{
$(document).ready(()=>{
$jq351=jQuery.noConflict(true),this.myInit(mode,json_data)
})})})})})})})})})})},
include:function(src,integrity,crossorigin,onload){
var head=document.getElementsByTagName("head")[0],script=document.createElement("script")
;if(integrity)script.setAttribute("integrity",integrity)
;if(crossorigin)script.setAttribute("crossorigin",crossorigin)
;script.src=src,script.type="text/javascript",
script.onload=script.onreadystatechange=function(){
if(script.readyState){
if("complete"===script.readyState||"loaded"===script.readyState)script.onreadystatechange=null,
onload()}else onload()},head.appendChild(script)},
myInit:function(mode,json_data){
var parsedJson=this.parseInitJson(json_data)
;this.initDynamicContent(parsedJson),
window.onresize=this.resize,window.onresize=this.GoogleChartTimeLine,
this.addEventListeners(),
this.parent_class.init(mode,()=>JSON.stringify(parsedJson.widgetData)),
this.addRequiredFieldIndicators(),
this.setUpInitialState(),this.adjustForMode(mode),
this.GoogleChartTimeLine()},to_json:function(){
var widgetJsonString=this.parent_class.to_json(),dynamicContent=this.getDynamicContent(),output={
widgetData:JSON.parse(widgetJsonString),
fileName:dynamicContent.fileName,
startState:dynamicContent.startState,
duration:dynamicContent.duration,
numExits:dynamicContent.numExits,
numEntries:dynamicContent.numEntries,
stampTimes:dynamicContent.stampTimes,
stampStates:dynamicContent.stampStates,
allDurations:dynamicContent.allDurations}
;return JSON.stringify(output)},
from_json:function(json_data){
var parsedJson=JSON.parse(json_data)
;this.parent_class.from_json(JSON.stringify(parsedJson.widgetData))
},test_data:function(){
var testData=JSON.parse(this.parent_class.test_data()),stampStates=["entry","exit","entry","exit","entry","exit","entry"],stampTimes=[0,1,3,6,10,15,21],allDurations=[1,2,3,4,5,6,979],output={
fileName:"test",widgetData:testData,
startState:"on",duration:1e3,numEntries:3,
numExits:3,stampStates:stampStates,
stampTimes:stampTimes,allDurations:allDurations}
;return JSON.stringify(output)},
is_valid:function(b_suppress_message){
var fail=false,fail_log="",name
;if($("#the_form").find("select, textarea, input").each(function(){
if(!$(this).prop("required"));else if(!$(this).val())fail=true,
name=$(this).attr("id"),
fail_log+=name+" is required \n"
}),$("input[type='date']").each(function(){
var date=$(this).val();if(date){
var validDate=my_widget_script.isValidDate(date)
;if(!validDate)fail=true,fail_log+="Please enter valid date in form 'YYYY-MM-DD'"
}}),$("input[type='time']").each(function(){
var time=$(this).val();if(time){
var validtime=my_widget_script.isValidTime(time)
;if(!validtime)fail=true,fail_log+="Please enter valid time in form 'hh:mm' - 24 hr time"
}}),fail)return alert(fail_log);else{
var noErrors=[];return noErrors}},
is_edited:function(){
return this.parent_class.is_edited()},
reset_edited:function(){
return this.parent_class.reset_edited()},
parseInitJson:function(json_data){var jsonString
;if("string"===typeof json_data)jsonString=json_data;else jsonString=json_data()
;var parsedJson=JSON.parse(jsonString)
;return parsedJson},
initDynamicContent:function(parsedJson){
$(".filePath").text(parsedJson.fileName),
my_widget_script._fileName=parsedJson.fileName,
$(".clearOnLoad").text(""),my_widget_script._numExits=parsedJson.numExits,
my_widget_script._numEntries=parsedJson.numEntries,
my_widget_script._duration=parsedJson.duration,
$("#videoDur").val(my_widget_script._duration)
;var startState=parsedJson.startState
;if(my_widget_script._startState=parsedJson.startState,
my_widget_script.changeToState(my_widget_script._startState),
parsedJson.stampStates)my_widget_script._stampStates=parsedJson.stampStates
;if(parsedJson.stampTimes)my_widget_script._stampTimes=parsedJson.stampTimes
;if(parsedJson.allDurations)my_widget_script._allDurations=parsedJson.allDurations
;for(i=0;i<my_widget_script._stampStates.length;i++){
var movement="",time=NaN,duration=NaN
;movement=my_widget_script._stampStates[i],
time=my_widget_script._stampTimes[i],
duration=my_widget_script._allDurations[i]
;var $stampsDiv=$(".stampsDiv")
;if("exit"==movement)var newState="OFF",stateForButton="off";else if("entry"==movement)var newState="ON",stateForButton="on";else var newState="",stateForButton=""
;if(my_widget_script.makeStampRow($stampsDiv,movement,newState,time,duration),
i==my_widget_script._stampStates.length-1)my_widget_script.changeToState(stateForButton)
}my_widget_script.calcValues()},
adjustForMode:function(mode){
if("edit"!==mode&&"edit_dev"!==mode)$(".disableOnView").prop("disabled",true),
$(".hideView").hide(),
$(".bookmarkLink").parent().addClass("noPlay");else $(".hideEdit").hide()
},updateDurations:function(){
my_widget_script.getDuration()
;var lastDuration=my_widget_script._duration-my_widget_script._stampTimes[my_widget_script._stampTimes.length-1]
;my_widget_script._allDurations[my_widget_script._allDurations.length-1]=lastDuration,
$(".stampRow").last().find(".duration").text(lastDuration.toFixed(2)),
my_widget_script.GoogleChartTimeLine(),
my_widget_script.resize()},
uploadVideoFile:function(){
var file=document.getElementById("myfile").files[0],proceed=false
;if(!my_widget_script._fileName)proceed=true;else if(file.name==my_widget_script._fileName)proceed=true;else proceed=confirm("This is a different file than was previously analyzed in this widget. Do you want to proceed?")
;if(proceed){
$(".filePath").text(file.name),my_widget_script._fileName=file.name
;var fileURL=URL.createObjectURL(file)
;my_widget_script._vid.src=fileURL,my_widget_script._vid.playbackRate=$("#changeSpeed").val(),
$("#addStampButton").removeAttr("disabled"),
$("#removeStampButton").removeAttr("disabled")}
my_widget_script.resize()},
addEventListeners:function(){
$("#myfile").on("input",function(){
this.uploadVideoFile()
}),$("#videoPlayer").on("durationchange",function(){
my_widget_script.updateDurations()
}),$("#getDur").on("input",function(){
my_widget_script.updateDurations()
}),$("#videoDur").on("input",function(){
my_widget_script.updateDurations()
}),$("#changeSpeed").on("input",function(){
my_widget_script._vid.playbackRate=$(this).val()
}),$("#startState").on("input",function(){
if(!my_widget_script._numEntries>0&&!my_widget_script._numExits>0)var proceed=true;else var proceed=confirm("Changing this will remove all stamps. Do you wish to proceed?")
;if(proceed){var startState=$(this).val()
;my_widget_script._startState=$(this).val(),
my_widget_script.resetStamps(startState)}
}),$("#addStampButton").on("click",function(){
var currentState=$(this).data("state")
;if(currentState)my_widget_script.addStampFuncs(currentState);else alert("Enter the starting state of the dam")
}).on("keydown",e=>{
var key=e.key,vidSpeed=5,changeSpeed=false
;switch(key){case"q":vidSpeed=3,changeSpeed=true
;break;case"w":vidSpeed=5,changeSpeed=true;break
;case"a":vidSpeed=10,changeSpeed=true;break
;case"s":vidSpeed=16,changeSpeed=true;break
;case"z":
var timeInSec=parseFloat(my_widget_script.getTimeStamp())
;timeInSec-=30,this._vid.currentTime=timeInSec,
$("#addStampButton").select();break;case"c":
var timeInSec=parseFloat(my_widget_script.getTimeStamp())
;timeInSec+=30,this._vid.currentTime=timeInSec
;break;case"x":
if(this._vid.paused)this._vid.play();else this._vid.pause()
;$("#addStampButton").select();break;default:break
}
if(changeSpeed)$("#changeSpeed").val(vidSpeed),this._vid.playbackRate=vidSpeed,
$("#addStampButton").select()
}),$("#removeStampButton").on("click",function(){
var currentState=$("#addStampButton").data("state")
;my_widget_script.removeStampFuncs(currentState)
}),$("#clearStamps").on("click",function(){
var proceed=confirm("Are you sure that you want to remove all time stamps?")
;if(proceed)my_widget_script.resetStamps(my_widget_script._startState)
}),$("#copyDursButton").on("click",function(){
var $errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;my_widget_script.copyDurationsFuncs($errorMsg,$divForCopy)
}),$("#copyTimesButton").on("click",function(){
var $errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;my_widget_script.copyTimeStampsFuncs($errorMsg,$divForCopy)
}),$("#toCSV").on("click",e=>{
var fileName=$("#damID").val()+"_P"+$("#pnd").val()+"_ZT"+$("#zt").val(),$errorMsg=$("#errorMsg")
;this.toCSVFuncs(fileName,$errorMsg)
}),$("#copyDataButton").on("click",function(){
var $copyHead=$("#copyHead"),$tableToCopy=$("#outTable"),$tableDiv=$(".outTableDiv"),$errorMsg=$("#errorMsg"),$divForCopy=$("#forCopy")
;my_widget_script.copyDataFuncs($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy)
}),$(".simpleCalc").on("input",function(){
var elementID=this.id,calcID="."+elementID+"_calc"
;my_widget_script.watchValue($(this),$(calcID))
}),$(document).on("click",".stampMin:not(.noPlay) a",function(){
var vid=document.getElementById("videoPlayer")
;if(vid.src)vid.currentTime=$(this).attr("rel"),
vid.play(),$("#videoPlayer").focus(),
$("#addStampButton").select();else alert("Select a Video File")
})},changeToState:function(state){
if("off"==state)$("#addStampButton").val("Dam Enters Nest").data("state","off");else if("on"==state)$("#addStampButton").val("Dam Exists Nest").data("state","on");else $("#addStampButton").val("[Enter Start State]").data("state","")
},toggleState:function(currentState){
if("off"==currentState)my_widget_script.changeToState("on");else if("on"==currentState)my_widget_script.changeToState("off")
},addStampFuncs:function(currentState){
if(my_widget_script._vid.src){
my_widget_script.getDuration()
;var $stampsDiv=$(".stampsDiv"),timeInSec=parseFloat(my_widget_script.getTimeStamp())
;if(timeInSec<my_widget_script._duration){
var $previousRow=$stampsDiv.find(".stampRow").last(),previousTime=my_widget_script._stampTimes[my_widget_script._stampTimes.length-1]
;if(timeInSec>previousTime){
var lastDuration=timeInSec-previousTime
;$previousRow.find(".duration").text(lastDuration.toFixed(2)),
my_widget_script._allDurations[my_widget_script._allDurations.length-1]=lastDuration,
my_widget_script._stampTimes[my_widget_script._stampTimes.length]=timeInSec
;var thisDuration=my_widget_script._duration-timeInSec
;if(my_widget_script._allDurations[my_widget_script._allDurations.length]=thisDuration,
"on"==currentState)var movementType="exit",newState="OFF";else if("off"==currentState)var movementType="entry",newState="ON"
;my_widget_script._stampStates[my_widget_script._stampStates.length]=movementType,
my_widget_script.makeStampRow($stampsDiv,movementType,newState,timeInSec,thisDuration),
my_widget_script.addOneToVar(movementType),
my_widget_script.calcValues(),my_widget_script.toggleState(currentState)
}else my_widget_script._vid.pause(),
alert("Must be after previous stamp")}
my_widget_script.resize()}},
makeStampRow:function($div,className,newState,timeInSec,thisDuration){
var timeStamp=my_widget_script.getTimeFromSec(timeInSec)
;$div.append($("<div/>",{
class:"row stampRow "+className
}).append($("<div/>",{class:"col state "+className
}).append(newState)).append($("<div/>",{
class:"col stamp "+className,
"data-movement":className
}).append(timeInSec.toFixed(2))).append($("<div/>",{
class:"col stampMin "+className
}).append("<a href='javascript:;' rel='"+timeInSec+"' class='bookmarkLink'>"+timeStamp+"</a>")).append($("<div/>",{
class:"col duration "+className
}).append(thisDuration.toFixed(2))))},
removeStampFuncs:function(currentState){
if(my_widget_script._vid.src){
if("off"==currentState)var className="exit",currentNum=my_widget_script._numExits;else if("on"==currentState)var className="entry",currentNum=my_widget_script._numEntries
;if(currentNum>0){
my_widget_script.getDuration(),$(".stampRow").last().remove(),
my_widget_script._stampTimes.pop(),
my_widget_script._stampStates.pop(),my_widget_script._allDurations.pop()
;var lastDuration=my_widget_script._duration-my_widget_script._stampTimes[my_widget_script._stampTimes.length-1]
;my_widget_script._allDurations[my_widget_script._allDurations.length-1]=lastDuration,
$(".stampRow").last().find(".duration").text(lastDuration.toFixed(2)),
my_widget_script.toggleState(currentState),
my_widget_script.removeOneFromVar(className),
my_widget_script.calcValues(),my_widget_script._vid.pause()
}else alert("No stamps to remove")
;my_widget_script.resize()}},
resetStamps:function(startState){
if(my_widget_script.changeToState(startState),my_widget_script._numEntries=0,
my_widget_script._numExits=0,
my_widget_script._stampTimes=[],my_widget_script._stampStates=[],
my_widget_script._allDurations=[],
$(".stampRow").remove(),"off"==startState)var startState="exit",newState="OFF";else if("on"==startState)var startState="entry",newState="ON"
;my_widget_script.getDuration(),
my_widget_script.makeStampRow($(".stampsDiv"),startState,newState,0,my_widget_script._duration),
my_widget_script._stampTimes=[0],
my_widget_script._stampStates=[startState],my_widget_script._allDurations=[my_widget_script._duration],
my_widget_script.calcValues(),
my_widget_script.resize()},getDuration:function(){
if($("#getDur").is(":checked")&&my_widget_script._vid.src)var duration=my_widget_script._vid.duration;else{
var duration=$("#videoDur").val()
;if(duration)duration=parseFloat(duration);else duration=3600
}
$("#videoDur").val(duration),my_widget_script._duration=duration,$(".videoDur_calc").text(duration)
},getTimeStamp:function(){var timeStamp=""
;if(my_widget_script._vid.src)var timeStamp=my_widget_script._vid.currentTime
;return timeStamp},
getExistingText:function(txtarea){
var existingText=txtarea.value
;if(existingText)existingText+="\n"
;return existingText},
addOneToVar:function(exitOrEntry){
if("entry"==exitOrEntry)my_widget_script._numEntries++;else if("exit"==exitOrEntry)my_widget_script._numExits++
},removeOneFromVar:function(exitOrEntry){
if("entry"==exitOrEntry)my_widget_script._numEntries--;else if("exit"==exitOrEntry)my_widget_script._numExits--
},addOneToCounter:function($counter){
var val=$counter.val()
;if(val)var count=parseInt(val);else var count=0
;count+=1,$counter.val(count)},
removeOneFromCounter:function($counter){
var val=$counter.val();if(val>0){
var count=parseInt(val);count-=1}else var count=0
;$counter.val(count)},
getTimeFromSec:function(timeInSec){
var asDate=new Date
;asDate.setHours(0,0,timeInSec,0)
;var hours=("0"+asDate.getHours()).slice(-2),mins=("0"+asDate.getMinutes()).slice(-2),secs=("0"+asDate.getSeconds()).slice(-2),time=hours+":"+mins+":"+secs
;return time},getHoursMin:function(timeString){
timeString=timeString.split(":")
;var hours=parseInt(timeString[0],10),mins=parseInt(timeString[1],10)
;return split={hours:hours,mins:mins}},
addRequiredFieldIndicators:function(){
$(".needForTableLab").each(function(){
$(this).html("<span style='color:blue'>#</span>"+$(this).html())
}),$(".requiredLab").each(function(){
$(this).html("<span style='color:red'>*</span>"+$(this).html())
})},adjustTextareaHeight:function(txtarea){
txtarea.style.height="auto",txtarea.style.height=txtarea.scrollHeight+"px",
my_widget_script.resize()},
isValidTime:function(timeString){
var regEx="^(((([0-1][0-9])|(2[0-3])):[0-5][0-9]))$"
;if(!timeString.match(regEx))return false;else return true
},isTimeSupported:function(){
var input=document.createElement("input")
;input.setAttribute("type","time")
;var supported=true
;if("time"!==input.type)supported=false
;return my_widget_script.timeSupported=supported,
supported},timeSupported:true,
checkTimeFormat:function($timeInput){
if(!my_widget_script.timeSupported){
$timeInput.next(".timeWarning").remove()
;var time=$timeInput.val(),isValid=my_widget_script.isValidTime(time)
;if(!isValid)$timeInput.after('<div class="text-danger timeWarning">Enter time as "hh:mm" in 24-hr format</div>')
;my_widget_script.resize()}},
isValidDate:function(dateString){
var regEx=/^\d{4}-\d{2}-\d{2}$/
;if(!dateString.match(regEx))return false
;var d=new Date(dateString),dNum=d.getTime()
;if(!dNum&&0!==dNum)return false
;return d.toISOString().slice(0,10)===dateString},
isDateSupported:function(){
var input=document.createElement("input")
;input.setAttribute("type","date")
;var supported=true
;if("date"!==input.type)supported=false
;return my_widget_script.dateSupported=supported,
supported},dateSupported:true,
checkDateFormat:function($dateInput){
if(!my_widget_script.dateSupported){
$dateInput.next(".dateWarning").remove()
;var date=$dateInput.val(),isValid=my_widget_script.isValidDate(date)
;if(!isValid)$dateInput.after('<div class="text-danger dateWarning">Enter date as "YYYY-MM-DD"</div>')
;$dateInput.datepicker({dateFormat:"yy-mm-dd"
}),my_widget_script.resize()}},
setUpInitialState:function(){
my_widget_script.isDateSupported(),my_widget_script.isTimeSupported(),
$("input[type='date']").prop("placeholder","YYYY-MM-DD").on("change",function(){
my_widget_script.checkDateFormat($(this))
}).each(function(){
my_widget_script.checkDateFormat($(this))
}),$("input[type='time']").prop("placeholder","hh:mm").on("change",function(){
my_widget_script.checkTimeFormat($(this))
}).each(function(){
my_widget_script.checkTimeFormat($(this))
}),$(".myLeftCol").addClass("col-12 col-sm-6 col-md-4 col-lg-4 text-left text-sm-right"),
$("textarea.autoAdjust").each(function(){
this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")
}).on("input",function(){
my_widget_script.adjustTextareaHeight(this)
}),$(".simpleCalc").each(function(){
var elementID=this.id,calcID="."+elementID+"_calc"
;my_widget_script.watchValue($(this),$(calcID))
}),my_widget_script.calcValues(),
my_widget_script.resize(),$("#saveChart").on("click",()=>{
this.downloadTimeline()})},resize:function(){
my_widget_script.parent_class.resize_container()},
getDynamicContent:function(){var dynamicContent={
fileName:my_widget_script._fileName,
startState:my_widget_script._startState,
duration:my_widget_script._duration,
numExits:my_widget_script._numExits,
numEntries:my_widget_script._numEntries,
stampTimes:my_widget_script._stampTimes,
stampStates:my_widget_script._stampStates,
allDurations:my_widget_script._allDurations}
;return dynamicContent},
data_valid_form:function(){var valid=true
;if($(".needForTable").each(function(){
if(!$(this).val())valid=false
}),!valid)$("#errorMsg").html("<span style='color:red; font-size:36px;'>Please fill out all elements marked by a</span><span style='color:blue; font-size:36px;'> blue #</span>");else $("#errorMsg").html("")
;return valid},
watchValue:function($elToWatch,$elToUpdate){
var value=$elToWatch.val();$elToUpdate.text(value)
},calcValues:function(){
for(my_widget_script.getDuration(),$(".numEntries_calc").text(my_widget_script._numEntries),
$(".numExits_calc").text(my_widget_script._numExits),
my_widget_script._entryStamps=[],
my_widget_script._entryDurs=[],my_widget_script._exitStamps=[],
my_widget_script._exitDurs=[],
my_widget_script._timeOnNest=0,my_widget_script._timeOffNest=0,
my_widget_script._avgDurOnNest=0,
my_widget_script._avgDurOffNest=0,i=0;i<my_widget_script._stampStates.length;i++)if("exit"==my_widget_script._stampStates[i])my_widget_script._exitStamps[my_widget_script._exitStamps.length]=my_widget_script._stampTimes[i],
my_widget_script._exitDurs[my_widget_script._exitDurs.length]=my_widget_script._allDurations[i];else if("entry"==my_widget_script._stampStates[i])my_widget_script._entryStamps[my_widget_script._entryStamps.length]=my_widget_script._stampTimes[i],
my_widget_script._entryDurs[my_widget_script._entryDurs.length]=my_widget_script._allDurations[i]
;my_widget_script._timeOffNest=my_widget_script._exitDurs.reduce(function(a,b){
return a+b
},0),my_widget_script._timeOnNest=my_widget_script._entryDurs.reduce(function(a,b){
return a+b
},0),$(".timeOffNest_calc").text(my_widget_script._timeOffNest.toFixed(2)),
$(".timeOnNest_calc").text(my_widget_script._timeOnNest.toFixed(2)),
my_widget_script._avgDurOffNest=my_widget_script._timeOffNest/my_widget_script._exitDurs.length,
my_widget_script._avgDurOnNest=my_widget_script._timeOnNest/my_widget_script._entryDurs.length,
$(".avgDurOffNest_calc").text(my_widget_script._avgDurOffNest.toFixed(2)),
$(".avgDurOnNest_calc").text(my_widget_script._avgDurOnNest.toFixed(2)),
my_widget_script._percOffNest=my_widget_script._timeOffNest/my_widget_script._duration*100,
my_widget_script._percOnNest=my_widget_script._timeOnNest/my_widget_script._duration*100,
$(".percOffNest_calc").text(my_widget_script._percOffNest.toFixed(2)),
$(".percOnNest_calc").text(my_widget_script._percOnNest.toFixed(2)),
$("#outTable tr").each(function(){
$("td",this).each(function(){
var value=$(this).text()
;if(""===value||"NaN"===value)$(this).text("NA")})
}),my_widget_script.GoogleChartTimeLine(),
my_widget_script.resize()},
downloadCSV:function(csv,filename){
var csvFile,downloadLink;csvFile=new Blob([csv],{
type:"text/csv"
}),downloadLink=document.createElement("a"),downloadLink.download=filename,
downloadLink.href=window.URL.createObjectURL(csvFile),
downloadLink.style.display="none",
document.body.appendChild(downloadLink),downloadLink.click()
},zip:function(...args){var len=0,array
;for(array of args){var arrLen=array.length
;if(arrLen>len)len=arrLen}
for(var numArrays=args.length,arr=new Array(len),i=0;i<len;i+=1)for(array of(arr[i]=[],
args))arr[i].push(array[i]);return arr},
exportInfoToCSV:function(filename){
var csv=[],columnJoin=",",exitStamps=["OffTimes"].concat(this._exitStamps),entryStamps=["OnTimes"].concat(this._entryStamps),exitDurs=["OffDurations"].concat(this._exitDurs),entryDurs=["OnDurations"].concat(this._entryDurs),locationStates=["states"].concat(this._stampStates),changeTimes=["changeTimes"].concat(this._stampTimes)
;csv=this.zip(exitStamps,entryStamps,exitDurs,entryDurs,changeTimes,locationStates)
;for(var row=0;row<csv.length;row++)csv[row]=csv[row].join(columnJoin)
;this.downloadCSV(csv.join("\n"),filename)},
exportInfoToCSV_v2:function(filename){
var csv=[],exitStamps=my_widget_script._exitStamps,entryStamps=my_widget_script._entryStamps,exitDurs=my_widget_script._exitDurs,entryDurs=my_widget_script._entryDurs,row=[]
;for(row.push("OnTimes"),
row.push("OffTimes"),row.push("OnDurations"),row.push("OffDurations"),
csv.push(row.join(",")),
i=0;i<exitStamps.length||i<entryStamps.length||i<exitDurs.length||i<entryDurs.length;i++){
if(exitStamps[i])var exitTime=exitStamps[i];else var exitTime="NA"
;if(entryStamps[i])var entryTime=entryStamps[i];else var entryTime="NA"
;if(exitDurs[i])var exitDur=exitDurs[i];else var exitDur="NA"
;if(entryDurs[i])var entryDur=entryDurs[i];else var entryDur="NA"
;row=[],row.push(entryTime),
row.push(exitTime),row.push(entryDur),row.push(exitDur),
csv.push(row.join(","))}
this.downloadCSV(csv.join("\n"),filename)},
exportTableToCSV_old:function(filename,table){
for(var csv=[],datatable=document.getElementById(table),rows=datatable.querySelectorAll("tr"),i=0;i<rows.length;i++){
for(var row=[],cols=rows[i].querySelectorAll("td, th"),j=0;j<cols.length;j++){
var cellText='"'+cols[j].innerText+'"'
;row.push(cellText)}csv.push(row.join(","))}
var exitStamps=my_widget_script._exitStamps,entryStamps=my_widget_script._entryStamps,row=[]
;for(row.push("OnTimes"),
row.push("OffTimes"),csv.push(row.join(",")),i=0;i<exitStamps.length||i<entryStamps.length;i++){
if(exitStamps[i])var exitTime=exitStamps[i];else var exitTime="NA"
;if(entryStamps[i])var entryTime=entryStamps[i];else var entryTime="NA"
;var row=[]
;row.push(entryTime),row.push(exitTime),csv.push(row.join(","))
}
var exitDurs=my_widget_script._exitDurs,entryDurs=my_widget_script._entryDurs,row=[]
;for(row.push("OnDurations"),
row.push("OffDurations"),csv.push(row.join(",")),i=0;i<exitDurs.length||i<entryDurs.length;i++){
if(exitDurs[i])var exitDur=exitDurs[i];else var exitDur="NA"
;if(entryDurs[i])var entryDur=entryDurs[i];else var entryDur="NA"
;var row=[]
;row.push(entryDur),row.push(exitDur),csv.push(row.join(","))
}this.downloadCSV(csv.join("\n"),filename)},
copyTable:function($table,copyHead,$divForCopy){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;if(copyHead)$table.find("thead").children("tr").each(function(){
var addTab="";$(this).children().each(function(){
$temp.text($temp.text()+addTab+$(this).text()),
addTab="\t"})}),addLine="\n"
;$table.find("tbody").children("tr").each(function(){
$temp.text($temp.text()+addLine);var addTab=""
;$(this).find("td").each(function(){
if($(this).text())var addText=$(this).text();else var addText="NA"
;$temp.text($temp.text()+addTab+addText),
addTab="\t",addLine="\n"})
}),$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),
$temp.remove()},
copyDurations:function($divForCopy){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;$temp.text("OnDurations\tOffDurations")
;var exitDurs=my_widget_script._exitDurs,entryDurs=my_widget_script._entryDurs
;for(i=0;i<exitDurs.length||i<entryDurs.length;i++){
if(exitDurs[i])var exitDur=exitDurs[i];else var exitDur="NA"
;if(entryDurs[i])var entryDur=entryDurs[i];else var entryDur="NA"
;$temp.text($temp.text()+"\n"+entryDur+"\t"+exitDur)
}
$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),$temp.remove()
},copyTimeStamps:function($divForCopy){
var $temp=$("<text"+"area style='opacity:0;'></text"+"area>"),addLine=""
;$temp.text("OnTimes\tOffTimes")
;var exitStamps=my_widget_script._exitStamps,entryStamps=my_widget_script._entryStamps
;for(i=0;i<exitStamps.length||i<entryStamps.length;i++){
if(exitStamps[i])var exitTime=exitStamps[i];else var exitTime="NA"
;if(entryStamps[i])var entryTime=entryStamps[i];else var entryTime="NA"
;$temp.text($temp.text()+"\n"+entryTime+"\t"+exitTime)
}
$temp.appendTo($divForCopy).focus().select(),document.execCommand("copy"),$temp.remove()
},calcTableFuncs:function(){
my_widget_script.data_valid_form(),my_widget_script.calcValues()
},toCSVFuncs:function(fileName,$errorMsg){
var data_valid=this.data_valid_form()
;if(data_valid)this.calcValues(),this.exportInfoToCSV(fileName),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Saved successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Did not export</span>")
},
copyDataFuncs:function($copyHead,$tableToCopy,$tableDiv,$errorMsg,$divForCopy){
var data_valid=my_widget_script.data_valid_form(),copyHead
;if($copyHead.is(":checked"))copyHead=true;else copyHead=false
;if(my_widget_script.calcValues(),
data_valid)$tableDiv.show(),my_widget_script.resize(),
my_widget_script.copyTable($tableToCopy,copyHead,$divForCopy),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")
},
copyDurationsFuncs:function($errorMsg,$divForCopy){
var data_valid=my_widget_script.data_valid_form()
;if(my_widget_script.calcValues(),
data_valid)my_widget_script.copyDurations($divForCopy),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")
},
copyTimeStampsFuncs:function($errorMsg,$divForCopy){
var data_valid=my_widget_script.data_valid_form()
;if(my_widget_script.calcValues(),
data_valid)my_widget_script.copyTimeStamps($divForCopy),
$errorMsg.html("<span style='color:grey; font-size:24px;'>Copied successfully</span>");else $errorMsg.append("<br/><span style='color:grey; font-size:24px;'>Nothing was copied</span>")
},GoogleChartTimeLine:function(){
function drawChart(){
var container=document.getElementById("example3.1"),dataTable=new google.visualization.DataTable
;dataTable.addColumn({type:"string",id:"Position"
}),dataTable.addColumn({type:"date",id:"Start"
}),dataTable.addColumn({type:"date",id:"End"})
;var startTime=$("#recTime").val()
;if(startTime)var splitTime=my_widget_script.getHoursMin(startTime),startHour=splitTime.hours;else startHour=0
;for(i=0;i<my_widget_script._stampStates.length;i++){
var movement="",time=NaN,duration=NaN
;movement=my_widget_script._stampStates[i],
time=my_widget_script._stampTimes[i],
duration=my_widget_script._allDurations[i]
;var state=""
;if("exit"==movement)state="OFF Nest";else if("entry"==movement)state="ON Nest"
;dataTable.addRows([[state,new Date(0,0,0,startHour,0,time),new Date(0,0,0,startHour,0,time+duration)]])
}
if("off"==my_widget_script._startState)colors=["#f4c8ce","#ccdbf6"];else if("on"==my_widget_script._startState)colors=["#ccdbf6","#f4c8ce"]
;var options={hAxis:{title:"Time"},colors:colors,
avoidOverlappingGridLines:false
},container=document.getElementById("chart_div"),chart=new google.visualization.Timeline(container)
;chart.draw(dataTable,options)}
google.charts.load("current",{
packages:["timeline"]
}),google.charts.setOnLoadCallback(drawChart)}};